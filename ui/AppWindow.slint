import { Button, VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";
import { Theme } from "theme.slint";
import { ModernButton, IconButton, Divider, ThemeToggle } from "widgets.slint";

export component AppWindow inherits Window {
    title: "PDFbull";
    width: 1200px;
    height: 800px;
    background: Theme.background;

    in-out property<int> current_page: 0;
    in-out property<int> total_pages: 0;
    in-out property<float> zoom: 1.0;
    in-out property<string> status_text: "Ready - Open a PDF to begin";
    in-out property<bool> sidebar_visible: true;
    in-out property<image> pdf_page_image; 
    
    // Callbacks to request updates
    callback open_document();
    callback close_document();
    callback request_render(int, float);

    changed current_page => {
        request_render(current_page, zoom);
    }
    
    VerticalLayout {
        padding: 0px;

        // Top Toolbar
        Rectangle {
            height: 48px;
            background: Theme.surface;
            
            HorizontalLayout {
                padding-left: Theme.padding-md;
                padding-right: Theme.padding-md;
                spacing: Theme.padding-md;
                alignment: center;

                // Left side controls
                HorizontalLayout {
                    alignment: start;
                    spacing: Theme.padding-md;
                    
                    ModernButton {
                        text: "ðŸ“‚ Open PDF";
                        primary: true;
                        clicked => { open_document(); }
                    }
                    ModernButton {
                        text: "Close";
                        clicked => { close_document(); }
                    }
                }
                
                // Spacer
                Rectangle { horizontal-stretch: 1; }

                // Right side controls
                ThemeToggle {
                    toggled => { Theme.is-dark = !Theme.is-dark; }
                }
            }
            
            // Bottom border
            Divider { y: parent.height - 1px; }
        }

        HorizontalLayout {
            // Sidebar
            if sidebar_visible : Rectangle {
                width: 250px;
                background: Theme.surface;
                
                // Right border
                Rectangle {
                    width: 1px;
                    background: Theme.border;
                    x: parent.width - 1px;
                }
                
                VerticalLayout {
                    padding: Theme.padding-lg;
                    spacing: Theme.padding-md;
                    
                    Text { 
                        text: "Thumbnails"; 
                        font_size: Theme.font-lg; 
                        font-weight: 700; 
                        color: Theme.text-primary;
                    }
                    
                    Text { 
                        text: "Page navigation coming soon"; 
                        font_size: Theme.font-sm; 
                        color: Theme.text-secondary;
                    }
                }
            }

            // Main Content Area
            VerticalLayout {
                // Secondary Toolbar (Navigation)
                Rectangle {
                    height: 52px;
                    background: Theme.surface;
                    
                    // Bottom border
                    Divider { y: parent.height - 1px; }
                    
                    HorizontalLayout {
                        padding-left: Theme.padding-lg;
                        padding-right: Theme.padding-lg;
                        spacing: Theme.padding-lg;
                        alignment: center;

                        ModernButton {
                            text: "â—€ Prev";
                            clicked => {
                                if (current_page > 0) {
                                    current_page -= 1;
                                }
                            }
                        }

                        Text {
                            text: "Page " + (current_page + 1) + " of " + (total_pages > 0 ? total_pages : 1);
                            vertical_alignment: center;
                            color: Theme.text-primary;
                            font_size: Theme.font-lg;
                            font_weight: 500;
                        }

                        ModernButton {
                            text: "Next â–¶";
                            clicked => {
                                if (current_page < total_pages - 1) {
                                    current_page += 1;
                                }
                            }
                        }

                        // Spacer
                        Rectangle { width: 20px; }

                        HorizontalLayout {
                            spacing: Theme.padding-md;
                            
                            ModernButton {
                                text: "âˆ’";
                                clicked => { 
                                    zoom = max(0.25, zoom / 1.25); 
                                    request_render(current_page, zoom);
                                }
                            }

                            Text {
                                text: round(zoom * 100) + "%";
                                vertical_alignment: center;
                                color: Theme.text-primary;
                                font_size: Theme.font-lg;
                                font_weight: 500;
                                width: 50px;
                                horizontal-alignment: center;
                            }

                            ModernButton {
                                text: "+";
                                clicked => { 
                                    zoom = min(5.0, zoom * 1.25); 
                                    request_render(current_page, zoom);
                                }
                            }
                        }
                    }
                }

                // PDF View Area
                ScrollView {
                    viewport-width: pdf_page_image.width * 1px;
                    viewport-height: pdf_page_image.height * 1px;
                    
                    Rectangle {
                        background: Theme.background;
                        
                        HorizontalLayout { 
                            alignment: center; 
                            VerticalLayout { 
                                alignment: center;
                                padding: Theme.padding-lg;
                                
                                Rectangle {
                                    width: pdf_page_image.width * 1px;
                                    height: pdf_page_image.height * 1px;

                                    // Shadow
                                    Rectangle {
                                        x: 4px;
                                        y: 4px;
                                        width: 100%;
                                        height: 100%;
                                        background: #000000;
                                        opacity: 0.2;
                                    }

                                    // Image
                                    Image {
                                        width: 100%;
                                        height: 100%;
                                        source: pdf_page_image;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        // Status Bar
        Rectangle {
            height: 32px;
            background: Theme.surface;
            
            // Top border
            Divider { y: 0px; }
            
            HorizontalLayout {
                padding-left: Theme.padding-md;
                alignment: start;
                
                Text {
                    text: status_text;
                    font_size: Theme.font-sm;
                    color: Theme.text-secondary;
                    vertical-alignment: center;
                }
            }
        }
    }
}
